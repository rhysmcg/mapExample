<!DOCTYPE html>
<html>
<head>	
<title>USA MAP</title>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="shortcut icon" type="image/x-icon" href="docs/images/favicon.ico" />
<link rel="stylesheet" href="css/leaflet.css"/>
<script src="js/leaflet.js"></script>
<script src="js/wise-leaflet-pip.js"></script>
<script src="js/all.min.js"></script>

<style>
#map{
	margin:  0;
  	position: absolute;
  	padding: 0;
  	top: 0;
  	bottom: 0;
  	width: 99%;
}
.button {
	background-color: #008CBA;
	border: none;
	color: white;
	padding: 15px 32px;
	text-align: center;
	text-decoration: none;
	display: inline-block;
	font-size: 16px;
	margin: 4px 2px;
	cursor: pointer;
}

.leafletPopUp {
	font-weight: bold;
}
</style>

</head>
<body>
<div id="map"></div>
<script>
var map = L.map('map').setView([37.0902, -95.7129], 4);
map.options.zoomSnap = 0;
map.options.zoomDelta = 0.25;
map.options.maxZoom = 5;
map.options.minZoom = 4;



let Position = L.Control.extend({ 
      _container: null,
      options: {
        position: 'bottomleft'
},
  onAdd: function (map) {
    var latlng = L.DomUtil.create('div', 'mouseposition');
    this._latlng = latlng;
    return latlng;
  },

  updateHTML: function(lat, lng) {
    var latlng = lat + " " + lng;
    this._latlng.innerHTML = "LatLng: " + latlng;
  }
});

this.position = new Position();
this.map.addControl(this.position);

var dynamicPopup = L.popup()


var tiles = L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw', {
	maxZoom: 18,
	attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, ' +
		'Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',
	id: 'mapbox/streets-v11',
	tileSize: 512,
	zoomOffset: -1
}).addTo(map);

this.map.addEventListener('mousemove', (event) => {

    var lat = Math.round(event.latlng.lat * 100000) / 100000;
    var lng = Math.round(event.latlng.lng * 100000) / 100000;
    this.position.updateHTML(lat, lng);

    interSectingPlaces = []
  	
  	for (var i = 0; i < polyList.length; i++) {
  		poly = polyList[i];
  		interSecting = poly.contains({"lat": lat, "lng": lng});
  		interSectingPlaces.push({"id": poly._leaflet_id,"intersecting": interSecting})
  	}
  	console.log(interSectingPlaces)



  	for (var x = 0; x < interSectingPlaces.length; x++) {
  		place = interSectingPlaces[x];

  		var PopUpLayer = map._layers[place['id']];

  		if (place['intersecting'] == true) {
  			
  			dynamicPopup.setLatLng([lat, lng]);

  			cityName = PopUpLayer._popup._content

  			var content = `
  			<center>
  			<h2><i class="fas fa-map-marker"></i>  ${cityName} </h2> 
  			<h3>See eclipse viewing information from ${cityName} name.</h3>
  			<button class="button"> Click for Blog Site </button>
  			</center>



  			`


  			dynamicPopup.setContent(content);
  			dynamicPopup.openOn(map);
  		}


  		if (place['intersecting'] == false) {
  			//PopUpLayer.closePopup();

  		}

  	}
  })





</script>
    <script src="js/locations.js"></script>


</body>
</html>
